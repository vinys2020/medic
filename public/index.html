<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diagnóstico Médico</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="icon" href="/img/icologo.png" />
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: rgb(48, 110, 253);" id="myNavbar">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="/img/speak.png" alt="Isologotipo Diagnóstico Médico" width="100" height="100" />
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Inicio</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Enfermedades Comunes</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="enfermedades.html#tipos">Tipos de Enfermedades</a></li>
                            <li><a class="dropdown-item" href="enfermedades.html#sintomas">Buscar Enfermedades</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="estadisticas.html">Estadísticas de Diagnósticos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link custom-button" href="#" data-bs-toggle="modal"
                            data-bs-target="#contactModal">Contacto</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <section class="pt-0  bg-black">

        <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="contactModalLabel">Centro de Ayuda y Contacto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <img src="/img/diagnostico medico.png" alt="Imagen de Ayuda" class="img-fluid"
                                style="border-radius: 15px; width: 250px;">
                            <h2 class="mt-3">Centro de Soporte al Paciente</h2>
                            <p>Asistencia para Diagnóstico Médico en Línea</p>
                            <p>Correo electrónico de soporte: <a href="mailto:soporte@diagnostico.com"
                                    style="color: blue;">soporte@diagnostico.com</a></p>
                            <p>WhatsApp: <a href="https://wa.me/5493814685932" target="_blank" style="color: green;">+54
                                    9 381 4685-932</a></p>

                            <div class="social-media mt-3">
                                <a href="https://www.facebook.com/diagnostico_medico" target="_blank"
                                    class="btn btn-outline-primary">
                                    <i class="fab fa-facebook"></i> Facebook
                                </a>
                                <a href="https://twitter.com/diagnostico_medico" target="_blank"
                                    class="btn btn-outline-info">
                                    <i class="fab fa-twitter"></i> Twitter
                                </a>
                                <a href="https://www.instagram.com/diagnostico_medico/" target="_blank"
                                    class="btn btn-outline-danger">
                                    <i class="fab fa-instagram"></i> Instagram
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>



    </section>

    <section class="pt-5">

        <div class="container">
            <section class="row text-white align-items-center mb-0">
                <article class="col-12 col-lg-5 mb-5 text-center">
                    <h1 class="mb-3" style="color: black; font-size: 2.5rem; font-weight: bold;">
                        Hola, ¡Bienvenido!
                    </h1>

                    <p class="slide-up" style="color: black; font-size: 1.2rem; font-weight: 600;">
                        Esta plataforma es una herramienta orientativa de prediagnóstico diseñada para darte un primer
                        panorama sobre tu salud.
                    </p>

                    <p class="slide-up mt-3" style="color: black; font-size: 1.05rem; line-height: 1.6;">
                        A través de algoritmos basados en conocimientos médicos, te ayudamos a identificar posibles
                        causas de tus síntomas de forma accesible y rápida.
                    </p>

                    <p class="slide-up mt-3" style="color: black; font-size: 1rem; font-weight: 500;">
                        ⚠️ Este servicio no reemplaza una consulta médica profesional. Recomendamos acudir a un
                        especialista para confirmar cualquier sospecha y recibir tratamiento adecuado.
                    </p>
                </article>




                <article class="col-12 col-lg-7 mb-5 text-center">
                    <img class="img-fluid" style="border-radius: 5%; max-width: 80%;" src="/img/fotodoctora.png"
                        alt="¿Necesitas un increíble sitio web?" />

                </article>

            </section>


            <section on id="diagnostico">
                <article class="col-12 text-center slide-up" style="margin-top: 50px; margin-bottom: 300px;">
                    <div class="diagnostic-container my-5">
                        <h1 class="text-center mb-4" style="color: black;">Diagnóstico Médico</h1>

                        <div class="row">

                            <div class="col-12">
                                <div class="form-group">
                                    <label for="nombre" style="color: black;">Nombre del paciente:</label>
                                    <input type="text" class="form-control" id="nombre"
                                        placeholder="Ejemplo: Juan Pérez" required />
                                </div>
                            </div>

                            <div class="col-6 mt-3">
                                <div class="form-group">
                                    <label for="edad" style="color: black;">Edad:</label>
                                    <input type="number" class="form-control" id="edad" placeholder="Ejemplo: 30"
                                        required />
                                </div>
                            </div>

                            <div class="col-6 mt-3">
                                <div class="form-group">
                                    <label for="sexo" style="color: black;">Sexo:</label>
                                    <select class="form-control" id="sexo">
                                        <option value="M">Masculino</option>
                                        <option value="F">Femenino</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-12 mt-3">
                                <div class="form-group">
                                    <label for="fuma" style="color: black;">¿Fuma?</label>
                                    <select class="form-control" id="fuma">
                                        <option value="false">No</option>
                                        <option value="true">Sí</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-12 mt-3">
                                <div class="form-group">
                                    <label for="actividad-fisica" style="color: black;">¿Hace actividad física
                                        regularmente?</label>
                                    <select class="form-control" id="actividad-fisica">
                                        <option value="false">No</option>
                                        <option value="true">Sí</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-12 mt-3">
                                <div class="form-group">
                                    <label for="historial-familiar" style="color: black;">¿Tiene historial familiar de
                                        alguna enfermedad?</label>
                                    <select class="form-control" id="historial-familiar">
                                        <option value="false">No</option>
                                        <option value="true">Sí</option>
                                    </select>
                                </div>
                            </div>


                            <div class="col-6 mt-3">
                                <div class="form-group">
                                    <label for="dieta" style="color: black;">¿Tiene una dieta poco saludable?</label>
                                    <select class="form-control" id="dieta">
                                        <option value="false">No</option>
                                        <option value="true">Sí</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-6 mt-3">
                                <div class="form-group">
                                    <label for="estres" style="color: black;">¿Sufre de alto estrés?</label>
                                    <select class="form-control" id="estres">
                                        <option value="false">No</option>
                                        <option value="true">Sí</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-6 mt-3">
                                <div class="form-group">
                                    <label for="visitas-medico" style="color: black;">¿Visita regularmente al
                                        médico?</label>
                                    <select class="form-control" id="visitas-medico">
                                        <option value="false">No</option>
                                        <option value="true">Sí</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-6 mt-3">
                                <div class="form-group">
                                    <label for="sueño" style="color: black;">¿Cuántas horas duerme por noche?</label>
                                    <input type="number" class="form-control" id="sueño" placeholder="Ejemplo: 7" />
                                </div>
                            </div>

                        </div>

                        <div class="form-group mt-3">
                            <label for="sintomas" style="color: black; margin-bottom: 20px;">Ingrese los síntomas
                                (separados por coma):</label>
                            <input type="text" class="form-control" id="sintomas"
                                placeholder="Ejemplo: fiebre alta, tos, dolor de cabeza" />
                        </div>

                        <div class="d-flex justify-content-center align-items-center mt-4">
                            <button class="btn btn-danger me-2" id="iniciar-diagnostico">Iniciar Diagnóstico</button>
                        </div>

                        <div id="pregunta-container" style="display: none;" class="mt-4">
                            <p id="pregunta" class="font-weight-bold" style="color: black;"></p>
                            <input type="hidden" id="enfermedad" value="" />
                            <button class="btn btn-success" id="si-button">Sí</button>
                            <button class="btn btn-danger" id="no-button">No</button>
                        </div>

                        <div id="resultados-container" style="display: none;" class="mt-4">
                            <h2 style="color: black; margin-bottom: 20px; margin-top: 50px;">Resultados</h2>
                            <ul id="resultados" class="list-group"></ul>
                        </div>



                    </div>
                </article>
            </section>


        </div>
        <button class="scroll-top " style="position: fixed; bottom: 20px; right: 20px; display: none;">
            <a href="https://api.whatsapp.com/send?phone=5493814685931" target="_blank"
                style="color:rgb(15, 218, 15);"><i class="bi bi-whatsapp fs-3" title="Envíanos un WhatsApp!"></i></a>
        </button>
    </section>



    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD6u0AsNJ-Zq7o7UuaovY4kxGavoxDBBSM",
        authDomain: "diagnostico-medicodb.firebaseapp.com",
        projectId: "diagnostico-medicodb",
        storageBucket: "diagnostico-medicodb.firebasestorage.app",
        messagingSenderId: "534466090567",
        appId: "1:534466090567:web:525e60f17c6a1f2ecbc362",
        measurementId: "G-SHSGSWTKE3"
      };
    
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    
      // Cache para enfermedades cargadas de Firestore
      let enfermedades = [];
    
      // Cargar enfermedades desde Firestore
      async function cargarEnfermedades() {
        try {
          const snapshot = await db.collection('Enfermedades').get();
          enfermedades = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          console.log("Enfermedades cargadas:", enfermedades);
        } catch (error) {
          console.error("Error cargando enfermedades:", error);
        }
      }
    
      // Convertir "true"/"false" a booleano
      function toBoolean(str) {
        return str === "true";
      }
    
      // Guardar paciente en Firestore
      async function guardarPaciente(data) {
        try {
          const docRef = await db.collection("pacientes").add(data);
          alert("Datos guardados con éxito, ID: " + docRef.id);
        } catch (error) {
          console.error("Error guardando paciente:", error);
          alert("Error guardando datos");
        }
      }
    
      // Ejecutar carga inicial de enfermedades
      cargarEnfermedades();
    
      // Botón guardar riesgo
      document.getElementById("guardar-riesgo").addEventListener("click", () => {
        const nombre = document.getElementById("nombre").value.trim();
        const edad = parseInt(document.getElementById("edad").value);
        const sexo = document.getElementById("sexo").value;
        const fuma = toBoolean(document.getElementById("fuma").value);
        const actividad_fisica = toBoolean(document.getElementById("actividadFisica").value);
        const historial_familiar = toBoolean(document.getElementById("historialFamiliar").value);
        const dieta = document.getElementById("dieta").value;
        const estres = toBoolean(document.getElementById("estres").value);
        const visitas_medico = toBoolean(document.getElementById("visitasMedico").value);
        const sueño = parseInt(document.getElementById("sueño").value);
        const sintomasInput = document.getElementById("sintomas").value.trim();
        const sintomas = sintomasInput ? sintomasInput.split(",").map(s => s.trim()) : [];
    
        if (!nombre || isNaN(edad) || sintomas.length === 0 || isNaN(sueño)) {
          alert("Por favor, complete todos los campos requeridos.");
          return;
        }
    
        const data = {
          nombre,
          edad,
          sexo,
          fuma,
          actividad_fisica,
          historial_familiar,
          dieta,
          estres,
          visitas_medico,
          sueño,
          sintomas
        };
    
        guardarPaciente(data);
      });
    
      // Función para diagnosticar localmente usando enfermedades cargadas (ejemplo simple)
      function diagnosticar(sintomasUsuario) {
        // Simple lógica: devuelve enfermedades que tengan al menos 1 síntoma coincidente
        return enfermedades
          .map(e => {
            const sintomasEnf = e.sintomas || [];
            const matchCount = sintomasEnf.filter(s => sintomasUsuario.includes(s)).length;
            const porcentaje = sintomasEnf.length > 0 ? Math.round((matchCount / sintomasEnf.length) * 100) : 0;
    
            return {
              enfermedad: e.nombre,
              porcentaje,
              tratamiento: e.tratamiento || '',
              accion_descartar: e.accion || ''
            };
          })
          .filter(e => e.porcentaje > 0)
          .sort((a, b) => b.porcentaje - a.porcentaje);
      }
    
      // Botón iniciar diagnóstico (usa el backend para preguntas, pero también puedes usar diagnosticar() si quieres)
      document.getElementById("iniciar-diagnostico").onclick = function () {
        const nombre = document.getElementById("nombre").value.trim();
        const edad = document.getElementById("edad").value.trim();
        const sintomasInput = document.getElementById("sintomas").value.trim();
        const sueño = document.getElementById("sueño").value.trim();
    
        if (!nombre || !edad || !sintomasInput || !sueño) {
          alert("Por favor, complete todos los campos requeridos.");
          return;
        }
    
        // Aquí haces fetch a backend para la lógica paso a paso (como tienes ahora)
        fetch('/diagnosticar', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sintomas: sintomasInput.split(",").map(s => s.trim()) })
        })
          .then(response => response.json())
          .then(data => {
            if (data.pregunta) {
              document.getElementById("pregunta").innerText = data.pregunta;
              document.getElementById("enfermedad").value = data.enfermedad;
              document.getElementById("pregunta-container").style.display = 'block';
            } else {
              alert(data.message);
            }
          })
          .catch(error => console.error('Error:', error));
      };
    
      document.getElementById("si-button").onclick = function () {
        enviarRespuesta(true);
      };
    
      document.getElementById("no-button").onclick = function () {
        enviarRespuesta(false);
      };
    
      function enviarRespuesta(respuesta) {
        const enfermedad = document.getElementById("enfermedad").value;
    
        fetch('/respuesta', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ enfermedad, respuesta })
        })
          .then(response => response.json())
          .then(data => {
            if (data.pregunta) {
              document.getElementById("pregunta").innerText = data.pregunta;
              document.getElementById("enfermedad").value = data.enfermedad;
            } else {
              mostrarResultados(data);
            }
          })
          .catch(error => console.error('Error:', error));
      }
    
      // Mostrar resultados y guardar paciente con diagnóstico
      function mostrarResultados(data) {
        const resultadosList = document.getElementById("resultados");
        resultadosList.innerHTML = '';
    
        // Mapeamos resultados para guardar
        const resultadosGuardar = data.map(item => ({
          enfermedad: item.enfermedad,
          porcentaje: item.porcentaje,
          tratamiento: item.tratamiento,
          accion_descartar: item.accion_descartar
        }));
    
        data.forEach(item => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.innerText = `${item.enfermedad} - ${item.porcentaje}% - Tratamiento: ${item.tratamiento} - Acción: ${item.accion_descartar}`;
          resultadosList.appendChild(li);
        });
    
        // Obtenemos campos del formulario
        const nombre = document.getElementById("nombre")?.value || '';
        const edad = parseInt(document.getElementById("edad")?.value) || 0;
        const sexo = document.getElementById("sexo")?.value || '';
        const fuma = toBoolean(document.getElementById("fuma")?.value || "false");
        const actividad_fisica = toBoolean(document.getElementById("actividadFisica")?.value || "false");
        const historial_familiar = toBoolean(document.getElementById("historialFamiliar")?.value || "false");
        const dieta = document.getElementById("dieta")?.value || '';
        const estres = toBoolean(document.getElementById("estres")?.value || "false");
        const visitas_medico = toBoolean(document.getElementById("visitasMedico")?.value || "false");
        const sueño = parseInt(document.getElementById("sueño")?.value) || 0;
        const sintomasInput = document.getElementById("sintomas")?.value || '';
        const sintomas = sintomasInput ? sintomasInput.split(",").map(s => s.trim()) : [];
    
        const pacienteData = {
          nombre,
          edad,
          sexo,
          fuma,
          actividad_fisica,
          historial_familiar,
          dieta,
          estres,
          visitas_medico,
          sueño,
          sintomas,
          diagnostico: resultadosGuardar.reduce((acc, cur) => {
            acc[cur.enfermedad] = cur.porcentaje;
            return acc;
          }, {})
        };
    
        guardarPaciente(pacienteData);
    
        document.getElementById("pregunta-container").style.display = 'none';
        document.getElementById("resultados-container").style.display = 'block';
      }
    </script>
    

    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="/js/main.js"></script>
</body>
<footer class=" p-3" style="background-color: rgb(20, 40, 100);">
    <div class="container text-center">
        <nav class="d-flex justify-content-evenly">
            <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                <i class="bi bi-facebook fs-3"></i>
            </a>
            <a href="https://twitter.com" target="_blank" aria-label="Twitter">
                <i class="bi bi-twitter fs-3"></i>
            </a>
            <a href="https://github.com" target="_blank" aria-label="GitHub">
                <i class="bi bi-github fs-3"></i>
            </a>
            <a href="https://youtube.com" target="_blank" aria-label="YouTube">
                <i class="bi bi-youtube fs-3"></i>
            </a>
            <a href="https://www.instagram.com/publik.tuc/" target="_blank" aria-label="Instagram">
                <i class="bi bi-instagram fs-3"></i>
            </a>
            <a href="https://m.me/user" target="_blank" aria-label="Messenger">
                <i class="bi bi-messenger fs-3"></i>
            </a>
            <a href="https://api.whatsapp.com/send?phone=5493814685931" target="_blank" aria-label="WhatsApp">
                <i class="bi bi-whatsapp fs-3"></i>
            </a>
        </nav>

        <article class="col-12 col-md-12 col-lg-12 d-flex justify-content-center">
            <br>
        </article>

        <small class="text-white">
            &copy; 2024 Diagnóstico Salud. Diagnósticos precisos y atención médica personalizada. Página creada por
            Publik.
            <a href="https://www.instagram.com/facundolezcano_/" target="_blank" class="text-info">Cuenta
                personal</a>.
        </small>
    </div>

</footer>

<script>
    const navbar = document.getElementById('myNavbar');
    let lastScrollY = window.scrollY;

    navbar.style.transition = 'top 0.3s ease-in-out';

    window.addEventListener('wheel', function (event) {
        if (event.deltaY > 0) {

            navbar.style.top = "-20px";
        } else {

            navbar.style.top = "0";
        }
    });
</script>

</html>